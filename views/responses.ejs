<%- include('partials/header') %>

<div class="container">
  <div class="admin-header">
    <h1>Survey Responses</h1>
    <div class="admin-actions">
      <a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a>
      <a href="/responses/export/csv" class="btn btn-success">Export to CSV</a>
    </div>
  </div>

  <% if (typeof success !== 'undefined' && success) { %>
    <div class="success-message">
      <%= success %>
    </div>
  <% } %>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="error-message" style="background-color: #fee; padding: 1rem; border-radius: 0.375rem; margin-bottom: 1rem;">
      <%= error %>
    </div>
  <% } %>

  <div class="card" style="margin-bottom: 2rem;">
    <p><strong>Total Responses:</strong> <%= totalResponses %></p>
  </div>

  <% if (responses.length === 0) { %>
    <div class="card">
      <p style="text-align: center; color: var(--text-light); padding: 2rem;">
        No responses yet. Responses will appear here once users submit the survey.
      </p>
    </div>
  <% } else { %>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Store Name</th>
            <th>Store Code</th>
            <th>Employee Name</th>
            <th>Department</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% responses.forEach((response) => { %>
            <tr>
              <td><%= new Date(response.submittedAt).toLocaleDateString() %></td>
              <td><%= response.storeName %></td>
              <td><%= response.storeCode %></td>
              <td><%= response.employeeName %></td>
              <td><%= response.department %></td>
              <td><%= response.email %></td>
              <td>
                <div style="display: flex; gap: 0.5rem;">
                  <a href="/responses/<%= response._id %>" class="btn btn-small btn-secondary">View</a>
                  <form action="/responses/delete/<%= response._id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this response?')">
                    <button type="submit" class="btn btn-small btn-danger">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

     Pagination 
    <% if (totalPages > 1) { %>
      <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;">
        <% if (currentPage > 1) { %>
          <a href="/responses?page=<%= currentPage - 1 %>" class="btn btn-secondary btn-small">Previous</a>
        <% } %>

        <% for (let i = 1; i <= totalPages; i++) { %>
          <% if (i === currentPage) { %>
            <span class="btn btn-primary btn-small"><%= i %></span>
          <% } else if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) { %>
            <a href="/responses?page=<%= i %>" class="btn btn-secondary btn-small"><%= i %></a>
          <% } else if (i === currentPage - 3 || i === currentPage + 3) { %>
            <span style="padding: 0.5rem;">...</span>
          <% } %>
        <% } %>

        <% if (currentPage < totalPages) { %>
          <a href="/responses?page=<%= currentPage + 1 %>" class="btn btn-secondary btn-small">Next</a>
        <% } %>
      </div>
    <% } %>
  <% } %>
</div>

<%- include('partials/footer') %>
